// This is your Prisma schema file for AlatBerat App
// Documentation: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Heavy Equipment model
model HeavyEquipment {
  id              String   @id @default(uuid()) @db.Uuid
  name            String   @db.VarChar(255)
  category        String   @db.VarChar(100)
  description     String?  @db.Text
  specifications  Json?    @db.JsonB
  pricePerHour    Decimal? @map("price_per_hour") @db.Decimal(10, 2)
  imageUrl        String?  @map("image_url") @db.Text
  isAvailable     Boolean  @default(true) @map("is_available")
  createdAt       DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt       DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  images EquipmentImage[]

  @@map("heavy_equipment")
  @@index([category])
  @@index([isAvailable])
}

// Equipment Images model for multiple images per equipment
model EquipmentImage {
  id          String   @id @default(uuid()) @db.Uuid
  equipmentId String   @map("equipment_id") @db.Uuid
  imageUrl    String   @map("image_url") @db.Text
  isPrimary   Boolean  @default(false) @map("is_primary")
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  // Relations
  equipment HeavyEquipment @relation(fields: [equipmentId], references: [id], onDelete: Cascade)

  @@map("equipment_images")
  @@index([equipmentId])
}

// Admin User model for authentication
model AdminUser {
  id        String   @id @default(uuid()) @db.Uuid
  email     String   @unique @db.VarChar(255)
  password  String   @db.VarChar(255)
  name      String?  @db.VarChar(255)
  role      String   @default("admin") @db.VarChar(50)
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  @@map("admin_users")
  @@index([email])
}

// Surat Jalan (Delivery Letter) model
model SuratJalan {
  id                String          @id @default(uuid()) @db.Uuid
  noSurat           String          @unique @db.VarChar(50)
  tanggal           DateTime        @db.Date
  jenisKendaraan    String          @map("jenis_kendaraan") @db.VarChar(100)
  noPol             String          @map("no_pol") @db.VarChar(20)
  sopir             String          @db.VarChar(255)
  tujuan            String?         @db.Text
  keterangan        String?         @db.Text
  status            String          @default("draft") @db.VarChar(50) // draft, printed, completed
  createdBy         String?         @map("created_by") @db.VarChar(255)
  createdAt         DateTime        @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime        @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  items SuratJalanItem[]

  @@map("surat_jalan")
  @@index([tanggal])
  @@index([noPol])
  @@index([status])
}

// Surat Jalan Items model (equipment in each letter)
model SuratJalanItem {
  id          String   @id @default(uuid()) @db.Uuid
  suratId     String   @map("surat_id") @db.Uuid
  urutan      Int      // Order number (1, 2, 3, etc)
  jenisUnit   String   @map("jenis_unit") @db.VarChar(255)
  seri        String   @db.VarChar(255)
  lokasi      String   @db.VarChar(255)
  keterangan  String?  @db.Text
  createdAt   DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  // Relations
  surat SuratJalan @relation(fields: [suratId], references: [id], onDelete: Cascade)

  @@map("surat_jalan_items")
  @@index([suratId])
  @@unique([suratId, urutan])
}

// Surat Perjanjian (Equipment Rental Agreement) model
model SuratPerjanjian {
  id                      String                    @id @default(uuid()) @db.Uuid
  noPerjanjian            String                    @unique @db.VarChar(100)
  tanggal                 DateTime                  @db.Date
  tanggalPernyataan       String?                   @map("tanggal_pernyataan") @db.Text // Text format like "Delapan Belas bulan Oktober Tahun Dua Ribu Tujuh Belas"

  // Pihak Pertama (Company/VSJ)
  pihakPertamaNama        String                    @map("pihak_pertama_nama") @db.VarChar(255)
  pihakPertamaJabatan     String                    @map("pihak_pertama_jabatan") @db.VarChar(255)
  pihakPertamaPerusahaan  String                    @map("pihak_pertama_perusahaan") @db.VarChar(255)
  pihakPertamaAlamat      String                    @map("pihak_pertama_alamat") @db.Text

  // Pihak Kedua (Customer/Renter)
  pihakKeduaNama          String                    @map("pihak_kedua_nama") @db.VarChar(255)
  pihakKeduaJabatan       String                    @map("pihak_kedua_jabatan") @db.VarChar(255)
  pihakKedualPerusahaan   String                    @map("pihak_kedua_perusahaan") @db.VarChar(255)
  pihakKeduaAlamat        String                    @map("pihak_kedua_alamat") @db.Text

  // Rental Details
  lokasiPekerjaan         String                    @map("lokasi_pekerjaan") @db.Text
  tanggalMulai            DateTime                  @map("tanggal_mulai") @db.Date
  tanggalSelesai          DateTime                  @map("tanggal_selesai") @db.Date

  keterangan              String?                   @db.Text
  status                  String                    @default("draft") @db.VarChar(50) // draft, printed, completed
  createdBy               String?                   @map("created_by") @db.VarChar(255)
  createdAt               DateTime                  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt               DateTime                  @default(now()) @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  items SuratPerjanjianItem[]

  @@map("surat_perjanjian")
  @@index([tanggal])
  @@index([status])
}

// Surat Perjanjian Items model (equipment in rental agreement)
model SuratPerjanjianItem {
  id                  String                @id @default(uuid()) @db.Uuid
  suratPerjanjianId   String                @map("surat_perjanjian_id") @db.Uuid
  urutan              Int
  jenisAlat           String                @map("jenis_alat") @db.VarChar(255)
  jumlah              Int
  hargaSewa           String                @map("harga_sewa") @db.VarChar(100)
  keterangan          String?               @db.Text
  createdAt           DateTime              @default(now()) @map("created_at") @db.Timestamptz(6)

  // Relations
  suratPerjanjian SuratPerjanjian @relation(fields: [suratPerjanjianId], references: [id], onDelete: Cascade)

  @@map("surat_perjanjian_items")
  @@index([suratPerjanjianId])
  @@unique([suratPerjanjianId, urutan])
}
